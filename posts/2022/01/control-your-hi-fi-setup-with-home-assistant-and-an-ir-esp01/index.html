<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content="Samuel Rodrigues ">
<meta name=description content="I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by Home-Assistant, an open-source home automation tool.">
<meta name=keywords content=",home-assistant,esphome,esp01">
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href=https://obito.fr/posts/2022/01/control-your-hi-fi-setup-with-home-assistant-and-an-ir-esp01/>
<title>
Control your HI-FI setup with Home-assistant and an IR-ESP01 :: Samuel Rodrigues — Portofolio, Thoughts, stories and ideas from my everyday life.
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=https://obito.fr/main.e575dd745b5f56e773747b15529fbc5e7d0be9bb114f7432f97625b4b3448ae0.css>
<link rel=apple-touch-icon sizes=180x180 href=https://obito.fr/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://obito.fr/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://obito.fr/favicon-16x16.png>
<link rel=manifest href=https://obito.fr/site.webmanifest>
<link rel=mask-icon href=https://obito.fr/safari-pinned-tab.svg color>
<link rel="shortcut icon" href=https://obito.fr/favicon.ico>
<meta name=msapplication-TileColor content>
<meta itemprop=name content="Control your HI-FI setup with Home-assistant and an IR-ESP01">
<meta itemprop=description content="I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by Home-Assistant, an open-source home automation tool."><meta itemprop=datePublished content="2022-01-25T17:13:00+01:00">
<meta itemprop=dateModified content="2022-01-25T17:13:00+01:00">
<meta itemprop=wordCount content="916"><meta itemprop=image content="https://obito.fr/">
<meta itemprop=keywords content="home-assistant,esphome,esp01,">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://obito.fr/">
<meta name=twitter:title content="Control your HI-FI setup with Home-assistant and an IR-ESP01">
<meta name=twitter:description content="I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by Home-Assistant, an open-source home automation tool.">
<meta property="og:title" content="Control your HI-FI setup with Home-assistant and an IR-ESP01">
<meta property="og:description" content="I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by Home-Assistant, an open-source home automation tool.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://obito.fr/posts/2022/01/control-your-hi-fi-setup-with-home-assistant-and-an-ir-esp01/"><meta property="og:image" content="https://obito.fr/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-01-25T17:13:00+01:00">
<meta property="article:modified_time" content="2022-01-25T17:13:00+01:00"><meta property="og:site_name" content="Samuel Rodrigues">
<meta property="article:published_time" content="2022-01-25 17:13:00 +0100 +0100">
</head>
<body>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=https://obito.fr/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>></span>
<span class=logo__text>Obito1903</span>
<span class=logo__cursor>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=https://obito.fr/posts>Blog</a></li><li><a href=https://obito.fr/projects>Projects</a></li>
<div class=submenu>
<li class=dropdown>
<a href=javascript:void(0) class=dropbtn>en</a>
<div class=dropdown-content>
</div>
</li>
</div>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<main class=post>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
5 minutes
</p>
</div>
<article>
<h1 class=post-title>
<a href=https://obito.fr/posts/2022/01/control-your-hi-fi-setup-with-home-assistant-and-an-ir-esp01/>Control your HI-FI setup with Home-assistant and an IR-ESP01</a>
</h1>
<hr>
<aside id=toc>
<div class=toc-title>Table of Contents</div>
<nav id=TableOfContents>
<ul>
<li><a href=#getting-your-remote-ir-codes>Getting your remote IR-codes</a></li>
<li><a href=#setting-up-esphome>Setting up ESPHome</a></li>
<li><a href=#wiring-up-the-ir-transceiver>Wiring up the IR-transceiver</a></li>
<li><a href=#adding-esphome-to-home-assistant>Adding ESPhome to Home-assistant</a></li>
</ul>
</nav>
</aside>
<hr>
<div class=post-content>
<img src=hass-player.png alt="Home-assistant media-player" class=center style=border-radius:8px>
<p>I recently bought a new integrated amplifier for my hi-fi setup to replace my old malfunctioning one. I mainly chose this one because I had a good deal on it, but it also came with a IR-remote to control it (not that impressive I know). And so naturally I wanted to automate it and add it with my IoT network which is controlled by <a href=https://www.home-assistant.io/>Home-Assistant</a>, an open-source home automation tool.</p>
<p>For this project I&rsquo;ll be using a ESP01 board with the <a href=https://esphome.io/>ESPHome</a> framework</p>
<h2 id=getting-your-remote-ir-codes>Getting your remote IR-codes</h2>
<p>Before beginning, you&rsquo;ll first need to get your hands on the remote IR-codes, to then be able to clone them with the ESP01. You have multiple option for that :</p>
<ul>
<li>Find your remote or one compatible with your device on sites that list remote IR-codes like Remote Central</li>
<li>Record them yourself with the help of a IR-receiver module (ex : VS1838B) connected to your ESP.</li>
</ul>
<p>Personally, since I did not have a receiver on hand, I went with Remote Central. On the website, you&rsquo;ll be presented with a list of the different functions for the remote you choose and their associated Pronto code. The format of the code might be different depending on the website where you found it, but in most cases, you&rsquo;ll be able to use them. To see if your protocol is compatible with ESPHome, check <a href=https://esphome.io/components/remote_transmitter.html>here</a></p>
<h2 id=setting-up-esphome>Setting up ESPHome</h2>
<p>ESPHome is a tool to easily connect, and configure devices like Arduino, and esp to Home Assistant. In this guide, we will use the CLI version of this tool in a docker container.</p>
<p>Go to a folder where you want to put the configuration for esp then initialize the ESPHome project :</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>docker run --rm -v <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>:/config -it esphome/esphome wizard ir_remote.yaml
</code></pre></div><p>This command will ask you to enter some information on the device you want to flash, name of the device, platform, board name, information about the network to which you want it to connect to, and finally the password of the ESPHome API that will be hosted on the board. At the end of the process, a YAML file will be generated with the name you specified earlier. It should look something like that :</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>esphome</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ir_remote</span>

<span style=color:#f92672>esp8266</span>:
  <span style=color:#f92672>board</span>: <span style=color:#ae81ff>esp01</span>

<span style=color:#75715e># Enable logging</span>
<span style=color:#f92672>logger</span>:

<span style=color:#75715e># Enable Home Assistant API</span>
<span style=color:#f92672>api</span>:
  <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;azertyuiop&#34;</span>

<span style=color:#f92672>ota</span>:
  <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;azertyuiop&#34;</span>

<span style=color:#f92672>wifi</span>:
  <span style=color:#f92672>ssid</span>: <span style=color:#e6db74>&#34;hello&#34;</span>
  <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;azertyuiop&#34;</span>

  <span style=color:#75715e># Enable fallback hotspot (captive portal) in case wifi connection fails</span>
  <span style=color:#f92672>ap</span>:
    <span style=color:#f92672>ssid</span>: <span style=color:#e6db74>&#34;IR-Remote Fallback Hotspot&#34;</span>
    <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;superstrongpassword&#34;</span>

<span style=color:#f92672>captive_portal</span>:
</code></pre></div><p>Next, we will need to tell ESPhome to create an IR transceiver. To do that, first, we&rsquo;ll need to define a remote_transmitter in our configuration file :</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>remote_transmitter</span>:
  <span style=color:#f92672>pin</span>: <span style=color:#ae81ff>GPIO2</span>
  <span style=color:#f92672>carrier_duty_percent</span>: <span style=color:#ae81ff>50</span><span style=color:#ae81ff>%</span>
</code></pre></div><p>Just change the pin entry to the pin to which you&rsquo;re IR-led will be connected.</p>
<p>Next, we&rsquo;ll have to add a <strong>button</strong> entity for each button that you want to emulate. Just add the button section to the YAML, and add a template platform for each of your buttons :</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>button</span>:
  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>template</span>
    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>amp_power_btn</span>
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Amp Power Button</span>
    <span style=color:#f92672>on_press</span>:
  - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>template</span>
    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>amp_vol_plus</span>
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Amp Vol+</span>
    <span style=color:#f92672>on_press</span>:
</code></pre></div><p>Then for each of the buttons, we need to specify a corresponding code to send when it is activated. For that, we need to add an action for each button under the <strong>on_press</strong> section. You can find a list of possible action <a href=https://esphome.io/components/remote_transmitter.html#remote-transmitter-actions>here</a>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>template</span>
    <span style=color:#f92672>id</span>: <span style=color:#ae81ff>amp_power_btn</span>
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Amp Power Button</span>
    <span style=color:#f92672>on_press</span>:
      - <span style=color:#f92672>remote_transmitter.transmit_pronto</span>:
          <span style=color:#f92672>data</span>: <span style=color:#e6db74>&#34;Some pronto hex code&#34;</span>
</code></pre></div><p>In some cases, the device you want to automate will need the code to be repeated multiple times for it to be registered. To do that you can just add a <strong>repeat</strong> section under our action. In my case, my amp requires the code to be sent 2 times :</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>remote_transmitter.transmit_pronto</span>:
    <span style=color:#f92672>data</span>: <span style=color:#e6db74>&#34;Some pronto hex code&#34;</span>
    <span style=color:#f92672>repeat</span>:
        <span style=color:#f92672>times</span>: <span style=color:#ae81ff>2</span>
</code></pre></div><p>Once you&rsquo;re done adding all your buttons we can move on to uploading the config to your ESP. To do that just plug your device in your computer and start the compilation and upload process with ESPhome :</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>docker run --rm -v <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>:/config --device<span style=color:#f92672>=</span>/dev/ttyUSB0 -it esphome/esphome run ir_remote.yaml
</code></pre></div><p>Where <code>/dev/ttyUSB0</code> is the usb port to which your ESP is connected.</p>
<h2 id=wiring-up-the-ir-transceiver>Wiring up the IR-transceiver</h2>
<p>Next step is to build our circuit to drive the led with the ESP.</p>
<p>You will need :</p>
<ul>
<li>A 3.3v power supply</li>
<li>1x infrared LED</li>
<li>1x 1k Ohm resistor</li>
<li>1x PNP Transistor (P2N2222A in my case)</li>
</ul>
<p><strong>Circuit diagram :</strong></p>
<img src=circuit-diagram.png alt="Circuit diagram" class=center style=border-radius:8px>
<p><br><br></p>
<img src=circuit-drawing.png alt="Circuit drawing" class=center style=border-radius:8px>
<p>Once everything is wired up you can power everything. To check if everything is working correctly you can go back to your pc and launch the ESPhome dashboard :</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>docker run --rm --net<span style=color:#f92672>=</span>host -v <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PWD<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>:/config -it esphome/esphome
</code></pre></div>
<img src=esp-home-dashboard.png alt="Circuit drawing" class=center style=border-radius:8px>
<p>If everything is fine you should see your device appear online within a minute or two.</p>
<h2 id=adding-esphome-to-home-assistant>Adding ESPhome to Home-assistant</h2>
<p>Finally to add your remote to Home-assistant you have to option :</p>
<ul>
<li>Wait for Home-assistant to find your ESPhome device.</li>
<li>Add it manually if you know its IP address.</li>
</ul>
<p>If you choose to add it manually, it&rsquo;s pretty simple just go to the Integrations menu in your Hass settings and add the ESPhome integration. It will prompt you to enter the IP of the ESP. Once done it will check if it can reach it and if so you are done.</p>
<p>One final note on the button entity, If you want to create a button in your Lovelace dashboard to control your remote we will tell the UI button to call the <strong>Button</strong> service on press and select the button entity to activate.</p>
<img src=hass-entity.png alt="Circuit drawing" class=center style=border-radius:8px>
</div>
</article>
<hr>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://obito.fr/tags/home-assistant/>home-assistant</a></span>
<span class=tag><a href=https://obito.fr/tags/esphome/>esphome</a></span>
<span class=tag><a href=https://obito.fr/tags/esp01/>esp01</a></span>
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
916 Words
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2022-01-25 16:13
</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://obito.fr/posts/2022/12/use-uuid-in-sqlite-database-with-rust-diesel.rs/>
<span class=button__icon>←</span>
<span class=button__text>Use UUID in SQLite database with Rust + Diesel.rs</span>
</a>
</span>
<span class="button next">
<a href=https://obito.fr/posts/2021/12/repair-grub-after-a-messy-windows-11-upgrade/>
<span class=button__text>Repair GRUB after a messy Windows 11 upgrade"</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</main>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=footer__content>
<span><a href=https://obito.fr/>Samuel Rodrigues</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span>
<span><a href=https://obito.fr/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span>
</div>
</div>
<div class=footer__inner>
<div class=footer__content>
<span>Powered by <a href=http://gohugo.io>Hugo</a></span><span>Made with &#10084; by <a href=https://github.com/obito1903>Obito1903</a></span>
</div>
</div>
</footer>
</div>
<script type=text/javascript src=https://obito.fr/bundle.min.617ca242d692c44a5b9d7d50bb64ecba7c8e8b8e27c8d46ada65aa90950dfd263fdf84787e4c894121633d2ca72c37cddc1defd82020753f6dfa812387c1139d.js integrity="sha512-YXyiQtaSxEpbnX1Qu2TsunyOi44nyNRq2mWqkJUN/SY/34R4fkyJQSFjPSynLDfN3B3v2CAgdT9t+oEjh8ETnQ=="></script>
<script defer data-domain=obito.fr src=https://plausible.obito.fr/js/script.js></script>
</body>
</html>